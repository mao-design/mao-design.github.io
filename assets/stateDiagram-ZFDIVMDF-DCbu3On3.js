import{_ as v,B as G,g as U}from"./chunk-AI4T2ZLM-jz_puMPl.js";import{f as O}from"./chunk-CCU7O4O5-DOlVeIoW.js";import{m as P}from"./chunk-EYG76IYJ-Djy_iqAd.js";import"./chunk-6EQESGSB-CaFZnb_7.js";import"./chunk-T244DUNM-MbXTYax3.js";import{m as y,a as t,h as T,aW as R,b1 as W,aZ as I,e as C,p as k,i as H,W as $}from"./mermaid.esm.min-C3I7Lns3.js";import"./chunk-OMTJKCYW-BNXI4fIe.js";import"./app-CNIuUWnT.js";var F=y(e=>e.append("circle").attr("class","start-state").attr("r",t().state.sizeUnit).attr("cx",t().state.padding+t().state.sizeUnit).attr("cy",t().state.padding+t().state.sizeUnit),"drawStartState"),J=y(e=>e.append("line").style("stroke","grey").style("stroke-dasharray","3").attr("x1",t().state.textHeight).attr("class","divider").attr("x2",t().state.textHeight*2).attr("y1",0).attr("y2",0),"drawDivider"),Y=y((e,i)=>{let g=e.append("text").attr("x",2*t().state.padding).attr("y",t().state.textHeight+2*t().state.padding).attr("font-size",t().state.fontSize).attr("class","state-title").text(i.id),s=g.node().getBBox();return e.insert("rect",":first-child").attr("x",t().state.padding).attr("y",t().state.padding).attr("width",s.width+2*t().state.padding).attr("height",s.height+2*t().state.padding).attr("rx",t().state.radius),g},"drawSimpleState"),_=y((e,i)=>{let g=y(function(o,f,w){let B=o.append("tspan").attr("x",2*t().state.padding).text(f);w||B.attr("dy",t().state.textHeight)},"addTspan"),s=e.append("text").attr("x",2*t().state.padding).attr("y",t().state.textHeight+1.3*t().state.padding).attr("font-size",t().state.fontSize).attr("class","state-title").text(i.descriptions[0]).node().getBBox(),d=s.height,l=e.append("text").attr("x",t().state.padding).attr("y",d+t().state.padding*.4+t().state.dividerMargin+t().state.textHeight).attr("class","state-description"),c=!0,a=!0;i.descriptions.forEach(function(o){c||(g(l,o,a),a=!1),c=!1});let n=e.append("line").attr("x1",t().state.padding).attr("y1",t().state.padding+d+t().state.dividerMargin/2).attr("y2",t().state.padding+d+t().state.dividerMargin/2).attr("class","descr-divider"),x=l.node().getBBox(),h=Math.max(x.width,s.width);return n.attr("x2",h+3*t().state.padding),e.insert("rect",":first-child").attr("x",t().state.padding).attr("y",t().state.padding).attr("width",h+2*t().state.padding).attr("height",x.height+d+2*t().state.padding).attr("rx",t().state.radius),e},"drawDescrState"),j=y((e,i,g)=>{let s=t().state.padding,d=2*t().state.padding,l=e.node().getBBox(),c=l.width,a=l.x,n=e.append("text").attr("x",0).attr("y",t().state.titleShift).attr("font-size",t().state.fontSize).attr("class","state-title").text(i.id),x=n.node().getBBox().width+d,h=Math.max(x,c);h===c&&(h=h+d);let o,f=e.node().getBBox();i.doc,o=a-s,x>c&&(o=(c-h)/2+s),Math.abs(a-f.x)<s&&x>c&&(o=a-(x-c)/2);let w=1-t().state.textHeight;return e.insert("rect",":first-child").attr("x",o).attr("y",w).attr("class",g?"alt-composit":"composit").attr("width",h).attr("height",f.height+t().state.textHeight+t().state.titleShift+1).attr("rx","0"),n.attr("x",o+s),x<=c&&n.attr("x",a+(h-d)/2-x/2+s),e.insert("rect",":first-child").attr("x",o).attr("y",t().state.titleShift-t().state.textHeight-t().state.padding).attr("width",h).attr("height",t().state.textHeight*3).attr("rx",t().state.radius),e.insert("rect",":first-child").attr("x",o).attr("y",t().state.titleShift-t().state.textHeight-t().state.padding).attr("width",h).attr("height",f.height+3+2*t().state.textHeight).attr("rx",t().state.radius),e},"addTitleAndBox"),Z=y(e=>(e.append("circle").attr("class","end-state-outer").attr("r",t().state.sizeUnit+t().state.miniPadding).attr("cx",t().state.padding+t().state.sizeUnit+t().state.miniPadding).attr("cy",t().state.padding+t().state.sizeUnit+t().state.miniPadding),e.append("circle").attr("class","end-state-inner").attr("r",t().state.sizeUnit).attr("cx",t().state.padding+t().state.sizeUnit+2).attr("cy",t().state.padding+t().state.sizeUnit+2)),"drawEndState"),q=y((e,i)=>{let g=t().state.forkWidth,s=t().state.forkHeight;if(i.parentId){let d=g;g=s,s=d}return e.append("rect").style("stroke","black").style("fill","black").attr("width",g).attr("height",s).attr("x",t().state.padding).attr("y",t().state.padding)},"drawForkJoinState"),X=y((e,i,g,s)=>{let d=0,l=s.append("text");l.style("text-anchor","start"),l.attr("class","noteText");let c=e.replace(/\r\n/g,"<br/>");c=c.replace(/\n/g,"<br/>");let a=c.split(T.lineBreakRegex),n=1.25*t().state.noteMargin;for(let x of a){let h=x.trim();if(h.length>0){let o=l.append("tspan");if(o.text(h),n===0){let f=o.node().getBBox();n+=f.height}d+=n,o.attr("x",i+t().state.noteMargin),o.attr("y",g+d+1.25*t().state.noteMargin)}}return{textWidth:l.node().getBBox().width,textHeight:d}},"_drawLongText"),K=y((e,i)=>{i.attr("class","state-note");let g=i.append("rect").attr("x",0).attr("y",t().state.padding),s=i.append("g"),{textWidth:d,textHeight:l}=X(e,0,0,s);return g.attr("height",l+2*t().state.noteMargin),g.attr("width",d+t().state.noteMargin*2),g},"drawNote"),A=y(function(e,i){let g=i.id,s={id:g,label:i.id,width:0,height:0},d=e.append("g").attr("id",g).attr("class","stateGroup");i.type==="start"&&F(d),i.type==="end"&&Z(d),(i.type==="fork"||i.type==="join")&&q(d,i),i.type==="note"&&K(i.note.text,d),i.type==="divider"&&J(d),i.type==="default"&&i.descriptions.length===0&&Y(d,i),i.type==="default"&&i.descriptions.length>0&&_(d,i);let l=d.node().getBBox();return s.width=l.width+2*t().state.padding,s.height=l.height+2*t().state.padding,s},"drawState"),D=0,Q=y(function(e,i,g){let s=y(function(n){switch(n){case v.relationType.AGGREGATION:return"aggregation";case v.relationType.EXTENSION:return"extension";case v.relationType.COMPOSITION:return"composition";case v.relationType.DEPENDENCY:return"dependency"}},"getRelationType");i.points=i.points.filter(n=>!Number.isNaN(n.y));let d=i.points,l=R().x(function(n){return n.x}).y(function(n){return n.y}).curve(W),c=e.append("path").attr("d",l(d)).attr("id","edge"+D).attr("class","transition"),a="";if(t().state.arrowMarkerAbsolute&&(a=I(!0)),c.attr("marker-end","url("+a+"#"+s(v.relationType.DEPENDENCY)+"End)"),g.title!==void 0){let n=e.append("g").attr("class","stateLabel"),{x,y:h}=C.calcLabelPosition(i.points),o=T.getRows(g.title),f=0,w=[],B=0,S=0;for(let r=0;r<=o.length;r++){let u=n.append("text").attr("text-anchor","middle").text(o[r]).attr("x",x).attr("y",h+f),p=u.node().getBBox();B=Math.max(B,p.width),S=Math.min(S,p.x),k.info(p.x,x,h+f),f===0&&(f=u.node().getBBox().height,k.info("Title height",f,h)),w.push(u)}let N=f*o.length;if(o.length>1){let r=(o.length-1)*f*.5;w.forEach((u,p)=>u.attr("y",h+p*f-r)),N=f*o.length}let M=n.node().getBBox();n.insert("rect",":first-child").attr("class","box").attr("x",x-B/2-t().state.padding/2).attr("y",h-N/2-t().state.padding/2-3.5).attr("width",B+t().state.padding).attr("height",N+t().state.padding),k.info(M)}D++},"drawEdge"),m,z={},V=y(function(){},"setConf"),tt=y(function(e){e.append("defs").append("marker").attr("id","dependencyEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 19,7 L9,13 L14,7 L9,1 Z")},"insertMarkers"),et=y(function(e,i,g,s){m=t().state;let d=t().securityLevel,l;d==="sandbox"&&(l=H("#i"+i));let c=d==="sandbox"?H(l.nodes()[0].contentDocument.body):H("body"),a=d==="sandbox"?l.nodes()[0].contentDocument:document;k.debug("Rendering diagram "+e);let n=c.select(`[id='${i}']`);tt(n);let x=s.db.getRootDoc();L(x,n,void 0,!1,c,a,s);let h=m.padding,o=n.node().getBBox(),f=o.width+h*2,w=o.height+h*2,B=f*1.75;$(n,w,B,m.useMaxWidth),n.attr("viewBox",`${o.x-m.padding}  ${o.y-m.padding} `+f+" "+w)},"draw"),at=y(e=>e?e.length*m.fontSizeFactor:1,"getLabelWidth"),L=y((e,i,g,s,d,l,c)=>{let a=new P({compound:!0,multigraph:!0}),n,x=!0;for(n=0;n<e.length;n++)if(e[n].stmt==="relation"){x=!1;break}g?a.setGraph({rankdir:"LR",multigraph:!0,compound:!0,ranker:"tight-tree",ranksep:x?1:m.edgeLengthFactor,nodeSep:x?1:50,isMultiGraph:!0}):a.setGraph({rankdir:"TB",multigraph:!0,compound:!0,ranksep:x?1:m.edgeLengthFactor,nodeSep:x?1:50,ranker:"tight-tree",isMultiGraph:!0}),a.setDefaultEdgeLabel(function(){return{}});let h=c.db.getStates(),o=c.db.getRelations(),f=Object.keys(h),w=!0;for(let r of f){let u=h[r];g&&(u.parentId=g);let p;if(u.doc){let E=i.append("g").attr("id",u.id).attr("class","stateGroup");if(p=L(u.doc,E,u.id,!s,d,l,c),w){E=j(E,u,s);let b=E.node().getBBox();p.width=b.width,p.height=b.height+m.padding/2,z[u.id]={y:m.compositTitleSize}}}else p=A(i,u,a);if(u.note){let E={descriptions:[],id:u.id+"-note",note:u.note,type:"note"},b=A(i,E,a);u.note.position==="left of"?(a.setNode(p.id+"-note",b),a.setNode(p.id,p)):(a.setNode(p.id,p),a.setNode(p.id+"-note",b)),a.setParent(p.id,p.id+"-group"),a.setParent(p.id+"-note",p.id+"-group")}else a.setNode(p.id,p)}k.debug("Count=",a.nodeCount(),a);let B=0;o.forEach(function(r){B++,k.debug("Setting edge",r),a.setEdge(r.id1,r.id2,{relation:r,width:at(r.title),height:m.labelHeight*T.getRows(r.title).length,labelpos:"c"},"id"+B)}),O(a),k.debug("Graph after layout",a.nodes());let S=i.node();a.nodes().forEach(function(r){r!==void 0&&a.node(r)!==void 0?(k.warn("Node "+r+": "+JSON.stringify(a.node(r))),d.select("#"+S.id+" #"+r).attr("transform","translate("+(a.node(r).x-a.node(r).width/2)+","+(a.node(r).y+(z[r]?z[r].y:0)-a.node(r).height/2)+" )"),d.select("#"+S.id+" #"+r).attr("data-x-shift",a.node(r).x-a.node(r).width/2),l.querySelectorAll("#"+S.id+" #"+r+" .divider").forEach(u=>{let p=u.parentElement,E=0,b=0;p&&(p.parentElement&&(E=p.parentElement.getBBox().width),b=parseInt(p.getAttribute("data-x-shift"),10),Number.isNaN(b)&&(b=0)),u.setAttribute("x1",0-b+8),u.setAttribute("x2",E-b-8)})):k.debug("No Node "+r+": "+JSON.stringify(a.node(r)))});let N=S.getBBox();a.edges().forEach(function(r){r!==void 0&&a.edge(r)!==void 0&&(k.debug("Edge "+r.v+" -> "+r.w+": "+JSON.stringify(a.edge(r))),Q(i,a.edge(r),a.edge(r).relation))}),N=S.getBBox();let M={id:g||"root",label:g||"root",width:0,height:0};return M.width=N.width+2*m.padding,M.height=N.height+2*m.padding,k.debug("Doc rendered",M,a),M},"renderDoc"),it={setConf:V,draw:et},lt={parser:G,get db(){return new v(1)},renderer:it,styles:U,init:y(e=>{e.state||(e.state={}),e.state.arrowMarkerAbsolute=e.arrowMarkerAbsolute},"init")};export{lt as diagram};
