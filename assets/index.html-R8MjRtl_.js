import{_ as i,c as n,a,o as e}from"./app-DFkAz4RW.js";const l={};function p(t,s){return e(),n("div",null,s[0]||(s[0]=[a(`<p>nginx有master进程和worker进程，master管理多个worker进程，worker进程则是管理用户连接</p><h2 id="yum安装" tabindex="-1"><a class="header-anchor" href="#yum安装"><span>yum安装</span></a></h2><blockquote><p>更多详细教程：<a href="https://nginx.org/en/linux_packages.html" target="_blank" rel="noopener noreferrer">nginx: Linux packages</a></p></blockquote><p>安装先决条件：</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> yum</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> install</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> yum-utils</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>要设置 yum 存储库，请创建以下内容命名的文件：<code>/etc/yum.repos.d/nginx.repo</code></p><div class="language-xml line-numbers-mode has-collapsed collapsed" data-ext="xml" data-title="xml" style="--vp-collapsed-lines:15;"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">[nginx-stable]</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">name=nginx stable repo</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">baseurl=http://nginx.org/packages/centos/$releasever/$basearch/</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">gpgcheck=1</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">enabled=1</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">gpgkey=https://nginx.org/keys/nginx_signing.key</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">module_hotfixes=true</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">[nginx-mainline]</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">name=nginx mainline repo</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">baseurl=http://nginx.org/packages/mainline/centos/$releasever/$basearch/</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">gpgcheck=1</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">enabled=0</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">gpgkey=https://nginx.org/keys/nginx_signing.key</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">module_hotfixes=true</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="collapsed-lines"></div></div><p>默认情况下，使用稳定的 nginx 包的存储库。 如果您想使用主线 nginx 包， 运行以下命令：</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> yum-config-manager</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --enable</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> nginx-mainline</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>要安装 nginx，请运行以下命令：</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> yum</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> install</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> nginx</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>当系统提示接受 GPG 密钥时，请验证指纹是否匹配 如果是这样，就接受它。</p><h2 id="源码安装" tabindex="-1"><a class="header-anchor" href="#源码安装"><span>源码安装</span></a></h2><div class="language-shell line-numbers-mode has-collapsed collapsed" data-ext="shell" data-title="shell" style="--vp-collapsed-lines:15;"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 安装必要环境</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">yum</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> install</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -y</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> gcc</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> pcre</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> pcre-devel</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> zlib</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> zlib-devel</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> openssl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> openssl-devel</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 下载nginx</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">wget</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> https://nginx.org/download/nginx-1.26.3.tar.gz</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 创建文件夹</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">mkdir</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> nginx</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 解压</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">tar</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -xzf</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> nginx-1.26.3.tar.gz</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /nginx</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">cd</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> nginx/nginx-1.26.3</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">./configure</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 编译安装</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">make</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">make</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> install</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 添加环境变量</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">vim</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /etc/profile</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 添加内容</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">export</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> PATH</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">$PATH</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">:/</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">usr</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">/</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">local</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">/</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">nginx</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">/</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">sbin</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">/</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 让环境生效</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">.</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /etc/profile</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="collapsed-lines"></div></div><h2 id="nginx语法" tabindex="-1"><a class="header-anchor" href="#nginx语法"><span>nginx语法</span></a></h2><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 启动nginx服务</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">nginx</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 停止nginx服务</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">nginx</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -s</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> stop</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 验证nginx.conf语法是否正确</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">nginx</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -t</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 重新加载nginx配置文件</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">nginx</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -s</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> reload</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="nginx信号" tabindex="-1"><a class="header-anchor" href="#nginx信号"><span>nginx信号</span></a></h2><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">root@hadoop01 logs</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"># ps -ef </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">|</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> grep</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> nginx</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">UID</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">         PID</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">   PPID</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">  C</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> STIME</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> TTY</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">          TIME</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> CMD</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># master 父进程</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">root</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">      34688</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">      1</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">  0</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 15:11</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ?</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">        00:00:00</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> nginx:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> master</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> process</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> nginx</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># worker 子进程</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">nobody</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">    34689</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">  34688</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">  0</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 15:11</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ?</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">        00:00:00</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> nginx:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> worker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> process</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><table><thead><tr><th>信号</th><th>作用</th></tr></thead><tbody><tr><td><code>term</code>/<code>int</code></td><td>不管有没有请求，立即关闭nginx服务（master和worker服务）</td></tr><tr><td><code>quit</code></td><td>把当前请求处理完，在关闭nginx服务（master和worker服务）</td></tr><tr><td><code>hup</code></td><td>在不重启nginx的情况下重新读取nginx配置文件</td></tr><tr><td><code>usr1</code></td><td>日志切割，将日志分为多分，避免日志文件过大</td></tr><tr><td><code>usr2</code></td><td>平滑升级nginx</td></tr><tr><td><code>winch</code></td><td>所有子进程不在接收新请求，且把当前请求处理完，在关闭worker子服务</td></tr></tbody></table><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 使用方法</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">kill</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -quit</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 34688</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">masterPID</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>winch</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">root@hadoop01 logs</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"># ps -ef </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">|</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> grep</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> nginx</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">root</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">      34688</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">      1</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">  0</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 15:11</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ?</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">        00:00:00</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> nginx:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> master</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> process</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> nginx</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">nobody</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">    42717</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">  34688</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">  0</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 17:19</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ?</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">        00:00:00</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> nginx:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> worker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> process</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">root</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">      42803</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 103651</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">  0</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 17:20</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> pts/1</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">    00:00:00</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> grep</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --color=auto</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> nginx</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">root@hadoop01 logs</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"># kill -winch 34688</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">root@hadoop01 logs</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"># ps -ef </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">|</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> grep</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> nginx</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">root</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">      34688</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">      1</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">  0</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 15:11</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ?</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">        00:00:00</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> nginx:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> master</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> process</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> nginx</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">root</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">      42897</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 103651</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">  0</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 17:21</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> pts/1</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">    00:00:00</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> grep</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --color=auto</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> nginx</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="系统环境" tabindex="-1"><a class="header-anchor" href="#系统环境"><span>系统环境</span></a></h2><p>编辑 <code>vim /usr/lib/systemd/system/nginx.service</code>，添加如下内容</p><div class="language- line-numbers-mode has-collapsed collapsed" data-ext="" data-title="" style="--vp-collapsed-lines:15;"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>[Unit]</span></span>
<span class="line"><span>Description=nginx web service</span></span>
<span class="line"><span>Documentation=http://nginx.org/en/docs/</span></span>
<span class="line"><span>After=network.target</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[Service]</span></span>
<span class="line"><span>Type=forking</span></span>
<span class="line"><span>PIDFile=/usr/local/nginx/logs/nginx.pid</span></span>
<span class="line"><span>ExecStartPre=/usr/local/nginx/sbin/nginx -t -c /usr/local/nginx/conf/nginx.conf</span></span>
<span class="line"><span>ExecStart=/usr/local/nginx/sbin/nginx</span></span>
<span class="line"><span>ExecReload=/usr/local/nginx/sbin/nginx -s reload</span></span>
<span class="line"><span>ExecStop=/usr/local/nginx/sbin/nginx -s stop</span></span>
<span class="line"><span>PrivateTmp=true</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[Install]</span></span>
<span class="line"><span>WantedBy=default.target</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="collapsed-lines"></div></div><p>设置权限 <code>chmod 755 /usr/lib/systemd/system/nginx.service</code></p><p>重新加载 <code>systemctl</code> ：<code>systemctl daemon-reload</code></p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 启动nginx</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">systemctl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> start</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> nginx</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 关闭nginx</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">systemctl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> stop</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> nginx</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">...</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="nginx不间断升级" tabindex="-1"><a class="header-anchor" href="#nginx不间断升级"><span>nginx不间断升级</span></a></h2><p>将老版本的nginx升级到新版本的nginx，并且服务不能停止</p><blockquote><p>将 nginx-1.24.0 升级到 nginx-1.26.3</p></blockquote><ol><li><p>编译 <code>nginx-1.26.3</code>，但不安装</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">cd</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /nginx-1.26.3</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">./configure</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">make</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>更改老版本的nginx名称</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">cd</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /usr/local/nginx/sbin</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">mv</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> nginx</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> nginxold</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>将新版本的nginx复制到 <code>/usr/local/nginx/sbin</code> 中</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">cd</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /nginx-1.26.3/objs</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">cp</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> nginx</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /usr/local/nginx/sbin</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>执行完上面三个步骤之后</p><p>回到上一级目录（也就是安装目录），执行升级命令</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">cd</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ..</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">make</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> upgrade</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-ext="" data-title=""><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>make upgrade原理</span></span>
<span class="line"><span></span></span>
<span class="line"><span>1. 发送usr2，通知老版本 master 进程启动新版本 master 进程</span></span>
<span class="line"><span></span></span>
<span class="line"><span>   kill -usr2 \`more /usr/local/nginx/logs/nginx.pid\`</span></span>
<span class="line"><span></span></span>
<span class="line"><span>2. 发送quit，通知老版本 master 进程优雅退出，老进程完全退出，由新进程接管所有请求</span></span>
<span class="line"><span></span></span>
<span class="line"><span>   kill -quit \`more /usr/local/nginx/logs/nginx.pid.oldbin\`</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="日志" tabindex="-1"><a class="header-anchor" href="#日志"><span>日志</span></a></h2><p>自定义日志路径</p><h2 id="日志-1" tabindex="-1"><a class="header-anchor" href="#日志-1"><span>日志</span></a></h2><p>自定义日志路径</p><div class="language- line-numbers-mode" data-ext="" data-title=""><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span># 日志</span></span>
<span class="line"><span># 作用：自定义日志的存放路径</span></span>
<span class="line"><span># 日志级别：debug|info|notice|warn|error|crit|alert|emerg</span></span>
<span class="line"><span>#    翻译：测试|信息|通知|警告|错误|临界|警报|紧急</span></span>
<span class="line"><span># 建议：不要设置info以下的等级，否则会大量消耗I/O，消耗，影响nginx性能</span></span>
<span class="line"><span>error_log  logs/error.log;</span></span>
<span class="line"><span>#error_log  logs/error.log  debug;</span></span>
<span class="line"><span>#error_log  logs/error.log  info;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="静态资源优化" tabindex="-1"><a class="header-anchor" href="#静态资源优化"><span>静态资源优化</span></a></h2><div class="language- line-numbers-mode" data-ext="" data-title=""><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>http {</span></span>
<span class="line"><span>	sendfile        on;</span></span>
<span class="line"><span>    tcp_nopush     on;</span></span>
<span class="line"><span>    tcp_nodelay    on;</span></span>
<span class="line"><span>    keepalive_timeout  65;</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="压缩" tabindex="-1"><a class="header-anchor" href="#压缩"><span>压缩</span></a></h2><div class="language- line-numbers-mode" data-ext="" data-title=""><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>http {</span></span>
<span class="line"><span>    gzip  on;</span></span>
<span class="line"><span>    gzip_types text/css;</span></span>
<span class="line"><span>    gzip_comp_level 6;        </span></span>
<span class="line"><span>    gzip_vary on;             </span></span>
<span class="line"><span>    gzip_min_length 1024;    </span></span>
<span class="line"><span>    gzip_disable &quot;msie [1-6]\\.&quot;;</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="小问题" tabindex="-1"><a class="header-anchor" href="#小问题"><span>小问题</span></a></h3><p><code>gzip</code> 和 <code>sendfile</code> 之间相互使用会有冲突，为了解决这个问题，使用下面的指令对文件进行预压缩</p><div class="language- line-numbers-mode" data-ext="" data-title=""><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>http {</span></span>
<span class="line"><span>    # 使用前要先安装模块 --with-http_gzip_static_module</span></span>
<span class="line"><span>    # 说明：允许 Nginx 直接提供预压缩的静态文件（如 .gz 文件）</span></span>
<span class="line"><span>    # 选项：on|off|always（默认off）</span></span>
<span class="line"><span>    # on：判断浏览器是否支持预压缩的静态文件，支持则发送，否则反之</span></span>
<span class="line"><span>    # always：不管浏览器是否支持预压缩的静态文件，都一律发送</span></span>
<span class="line"><span>    # 为了解决 gzip 和 sendfile 之间的冲突问题</span></span>
<span class="line"><span>    gzip_static on;</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 进入到项目文件夹中</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">gzip</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> *</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">.css</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 这样所有的 css 文件都被压缩成 *.css.gz 文件</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 预压缩就完成了</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 验证配置文件是否正确，然后重启nginx</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">nginx</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -t</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">nginx</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -s</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> reload</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="添加模块" tabindex="-1"><a class="header-anchor" href="#添加模块"><span>添加模块</span></a></h2><ol><li><p>进入到编译文件夹中 <code>nginx-1.26.3</code>，但不安装</p><p>添加 <code>--with-http_gzip_static_module</code> 模块，开启 <code>gzip_static</code> 需安装该模块</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">cd</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /nginx-1.26.3</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">./configure</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --prefix=/usr/local/nginx</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --with-http_gzip_static_module</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">make</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>更改nginx名称</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">cd</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /usr/local/nginx/sbin</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">mv</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> nginx</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> nginxold</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>将新版本的nginx复制到 <code>/usr/local/nginx/sbin</code> 中</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">cd</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /nginx-1.26.3/objs</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">cp</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> nginx</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /usr/local/nginx/sbin</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>回到上一级目录（也就是安装目录），执行升级命令</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">cd</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ..</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">make</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> upgrade</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h2 id="缓存" tabindex="-1"><a class="header-anchor" href="#缓存"><span>缓存</span></a></h2><p>expires：</p><p>该选项主要是用在老版浏览器上的</p><div class="language- line-numbers-mode has-collapsed collapsed" data-ext="" data-title="" style="--vp-collapsed-lines:15;"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>http {</span></span>
<span class="line"><span>    include       mime.types;</span></span>
<span class="line"><span>    default_type  application/octet-stream;</span></span>
<span class="line"><span>	# 控制页面缓存</span></span>
<span class="line"><span>    # 告诉浏览器或客户端如何缓存资源，从而减少重复请求、提升网站性能</span></span>
<span class="line"><span>    # 选项：time|max|epoch|off</span></span>
<span class="line"><span>    # max：等于 10 年</span></span>
<span class="line"><span>    # epoch：等于 no-cache（强制让资源立即过期，禁止客户端缓存该资源）</span></span>
<span class="line"><span>    # off：禁用自动添加缓存相关的响应头，让客户端（如浏览器）根据默认行为或其他自定义头来处理缓存。</span></span>
<span class="line"><span>    # 位置：http|server|location</span></span>
<span class="line"><span>    # d表示天，h表示小时，没有单位则默认表示秒</span></span>
<span class="line"><span>    expires 100d;</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>    # 图片资源缓存1个月</span></span>
<span class="line"><span>    add_header Cache-Control &quot;public, max-age=2592000&quot;;</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="collapsed-lines"></div></div><hr><p>cache-control选项：</p><p>该选项主要是用在新版浏览器上的</p><table><thead><tr><th><strong>指令</strong></th><th><strong>类型</strong></th><th><strong>描述</strong></th><th><strong>示例</strong></th></tr></thead><tbody><tr><td><code>max-age=秒数</code></td><td>数值型</td><td>资源在客户端缓存的最大时间（从请求时刻开始计算），到期后需重新验证</td><td><code>max-age=3600</code>（1 小时）</td></tr><tr><td><code>s-maxage=秒数</code></td><td>数值型</td><td>针对共享缓存（如 CDN）的最大缓存时间，优先级高于 <code>max-age</code></td><td><code>s-maxage=86400</code>（1 天）</td></tr><tr><td><code>public</code></td><td>布尔型</td><td>资源可被客户端和中间缓存（如代理、CDN）缓存</td><td><code>Cache-Control: public</code></td></tr><tr><td><code>private</code></td><td>布尔型</td><td>资源仅限客户端缓存，中间缓存不可存储（通常用于用户私有数据）</td><td><code>Cache-Control: private</code></td></tr><tr><td><code>no-cache</code></td><td>布尔型</td><td>资源可缓存，但使用前必须向服务器重新验证（需配合 <code>must-revalidate</code>）</td><td><code>Cache-Control: no-cache</code></td></tr><tr><td><code>no-store</code></td><td>布尔型</td><td>严格禁止任何形式的缓存，每次请求都必须从服务器获取资源（用于敏感数据）</td><td><code>Cache-Control: no-store</code></td></tr><tr><td><code>must-revalidate</code></td><td>布尔型</td><td>缓存过期后必须向服务器验证，否则不可使用过期资源</td><td><code>Cache-Control: must-revalidate</code></td></tr><tr><td><code>proxy-revalidate</code></td><td>布尔型</td><td>针对代理服务器的重新验证指令，功能类似 <code>must-revalidate</code>，但仅作用于中间缓存</td><td><code>Cache-Control: proxy-revalidate</code></td></tr><tr><td><code>max-stale=秒数</code></td><td>数值型</td><td>允许使用过期资源的最大时间（秒），到期后必须重新请求</td><td><code>max-stale=60</code>（最多使用过期 1 分钟）</td></tr><tr><td><code>min-fresh=秒数</code></td><td>数值型</td><td>要求资源在指定时间内必须是新鲜的（未过期），否则重新请求</td><td><code>min-fresh=300</code>（至少新鲜 5 分钟）</td></tr><tr><td><code>stale-while-revalidate</code></td><td>数值型</td><td>资源过期后，允许客户端继续使用缓存，同时后台异步向服务器验证更新（提升用户体验）</td><td><code>stale-while-revalidate=60</code>（过期后继续用 1 分钟）</td></tr></tbody></table><h2 id="跨域问题" tabindex="-1"><a class="header-anchor" href="#跨域问题"><span>跨域问题</span></a></h2><ul><li><strong>定义</strong>：浏览器规定，只有<strong>域名、端口、协议</strong>完全相同的两个资源之间才能相互访问（即 “同源”）。</li><li><strong>目的</strong>：防止恶意网站窃取用户数据（如 Cookie、LocalStorage 等）</li></ul><div class="language- line-numbers-mode" data-ext="" data-title=""><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span># 80端口默认是不写的，所以同源</span></span>
<span class="line"><span>http:192.168.1.2/index.html</span></span>
<span class="line"><span>http:192.168.1.2:80/index.html</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-ext="" data-title=""><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span># 协议不同，所以不是同源</span></span>
<span class="line"><span>http:192.168.1.2:8080/index.html</span></span>
<span class="line"><span>https:192.168.1.2:8080/index.html</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>实际开发中，当<strong>前端页面需要访问非同源的后端资源</strong>时，就需要解决跨域问题</p><div class="language- line-numbers-mode" data-ext="" data-title=""><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>location /api {</span></span>
<span class="line"><span>    # 指定允许访问资源的源（Origin），即哪些域名可以跨域请求该资源</span></span>
<span class="line"><span>    # add_header Accept-Control-Allow-Origin *; 表示允所有域名</span></span>
<span class="line"><span>    add_header Accept-Control-Allow-Origin http://192.168.1.2;</span></span>
<span class="line"><span>    # 指定允许的HTTP 请求方法</span></span>
<span class="line"><span>    add_header Accept-Control-Allow_Methods GET,POST,PUT,DELETE;</span></span>
<span class="line"><span>    default_type application/json;</span></span>
<span class="line"><span>    return 200 &#39;{&quot;id&quot;:1,&quot;name&quot;:&quot;He&quot;,&quot;age&quot;:123}&#39;;</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="防盗链" tabindex="-1"><a class="header-anchor" href="#防盗链"><span>防盗链</span></a></h2><h2 id="nginx配置文件" tabindex="-1"><a class="header-anchor" href="#nginx配置文件"><span>nginx配置文件</span></a></h2><p>非<code>events</code>和<code>http</code>块的代码为全局代码</p><p><code>events</code> 块：设置网络配置，主要设置用户与 <code>nginx</code> 之间的网络配置</p><p><code>http</code> 块：设置代理、缓存、日志记录、第三方模块。。。。。。</p><p><code>http</code>块中可以有多个 <code>server</code> 块</p><div class="language-xml line-numbers-mode has-collapsed collapsed" data-ext="xml" data-title="xml" style="--vp-collapsed-lines:15;"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"># 指定运行用户</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">user  nobody;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"># 工作进程</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"># 选项：on/off</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">master_processes  on;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"># 工作进程数量</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"># 选项：num/auto</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"># 使用前提是要开启工作进程 master_processes  on;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"># 数量越大，处理的并发请求就越多（worker进程也就越多）</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"># 建议数量值与服务器cpu核数一致</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">worker_processes  1;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"># 守护进程</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"># 选项：on/off（默认on）</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"># 开启之后，nginx服务可以在后台运行</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">daemon  on;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"># 指定nginx当前master进程的进程号ID存储的文件路径</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"># 默认路径：/usr/local/nginx/logs/nginx.pid</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">pid        logs/nginx.pid;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"># 日志</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"># 作用：自定义日志的存放路径</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"># 日志级别：debug|info|notice|warn|error|crit|alert|emerg</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">#    翻译：测试|信息|通知|警告|错误|临界|警报|紧急</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"># 建议：不要设置info以下的等级，否则会大量消耗I/O，消耗，影响nginx性能</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">error_log  logs/error.log;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">#error_log  logs/error.log  debug;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">#error_log  logs/error.log  info;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"># 引入其他路径的配置文件，使配置更灵活</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"># 引入的配置文件会生效</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">include  /home/main.conf;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">events {</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # 选项：on|off（默认on）</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # 因为nginx后台是多线程工作的，当客服端发送一个连接时，则会有多个worker进程被唤醒</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # 为了避免不必要的浪费，设置accept_mutex  on;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # 该选项对nginx进程接收的连接进行序列号处理，然后一个个唤醒接收，防止多个进程对连接的争抢</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # 当有多个请求的时候，启用该选项则会导致访问速度变慢</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # 所以更具生产环境来决定是否开启</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    accept_mutex  on;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # 多个网络连接</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # 选项：on|off（默认on）</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # 允许worker进程接收多个连接</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    multi_accept  on;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # 最大连接数</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # 选项：num</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # 单个worker进程最大连接数</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # 建议：不要超过操作系统支持打开的最大文件句柄数量</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    worker_connections  1024;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # 事件处理模型</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # 选项：select|poll|epoll|kqueue</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # 建议：选择poll|epoll</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # 选择对应的驱动来处理网络信息（epoll效率高一些）</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # 根据系统自动选择，Linux 默认为 epoll，BSD 为 kqueue，Windows 为 select。</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    use  epoll;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">http {</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    include       mime.types;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # 使用范围：http 、server 、location</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # 配置nginx响应请求资源类型</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # application/octet-stream：当浏览器接收到请求时，会以下载附件的方式来进行下载操作</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # text/html：以html格式显示</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # text/plain：以文本格式显示</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # application/json：显示json</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    default_type  application/octet-stream;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    #log_format  main  &#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    #                  &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    #                  &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    #access_log  logs/access.log  main;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # 日志：访问日志（access.log），错误日志（error.log）</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # 自定义访问日志文件路径</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # 使用范围：http 、server 、location</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    access_log  /usr/local/nginx/logs/my.log;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    </span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # 用于加速静态文件传输（如图片、CSS、JS）</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # 选项：on|off</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # 使用范围：http 、server 、location</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">	# 零拷贝传输优化</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    sendfile        on;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">	</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">	# 选项：on|off（默认off）</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # 前提：sendfile要在开启的状态下才能使用才指令</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # 相当于一个缓存空间</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # 作用：用来提升网络包传输效率的</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # 与 sendfile 配合，将多个小文件合并为一个 TCP 包发送，减少网络包数量。</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    tcp_nopush     on;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # 选项：on|off（默认on）</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # 前提：长链接 要在开启的状态下才能使用才指令</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # 作用：提高网络包传输的实时性</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # 禁用 Nagle 算法，强制立即发送小数据包，降低实时通信延迟。</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    tcp_nodelay    on;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # 长链接的访问时间</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # 选项：time</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # 每个请求都会重新创建一个连接，为了提升效率</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # 让连接的占线时间长一点，这样下一个请求在短时间内就不用重新创建连接了</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    keepalive_timeout  65;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # 处理100个请求之后就断开连接</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    keepalive_requests  100;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # 选项：on|off（默认off）</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # 压缩文件</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    gzip  on;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # 选项：</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # text/plain  纯文本文件（.txt）、日志文件、配置文件等</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # text/html     压缩html(默认)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # text/css    CSS 样式表文件（.css）</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # text/javascript     JavaScript 文件（.js，传统格式）</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # application/javascript      JavaScript 文件（.js，现代 ES6+ 格式） </span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # application/json    JSON 数据（如 API 响应、配置文件）</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # application/xml     XML 文件（.xml）、RSS 订阅源、SOAP 请求等</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # application/x-httpd-php     PHP 脚本输出的内容（动态生成的 HTML、JSON 等） </span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # font/ttf</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # font/otf      TrueType 和 OpenType 字体文件（.ttf、.otf）</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # image/svg+xml       SVG 矢量图（文本格式，非二进制）</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # application/font-woff</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # application/font-woff2</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # application/x-font-ttf</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # *     压缩所有文件</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    gzip_types text/css;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # 压缩级别（1-9），6 为平衡值</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # 取值 1-9，值越大压缩率越高，但 CPU 消耗也越大。</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # 推荐值为 6（平衡压缩率和性能），对性能敏感的场景可设为 4。</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    gzip_comp_level 6;        </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # 会在响应头中添加 Vary: Accept-Encoding</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # 告知缓存服务器（如 CDN）该内容有压缩和非压缩两个版本，避免缓存混乱。</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    gzip_vary on;             # 增加 Vary: Accept-Encoding 响应头</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # 仅压缩大于 1KB 的内容</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # 单位：k | m</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    gzip_min_length 1024;    </span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    </span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    # 当遇到 IE1~6 时禁用压缩功能</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    gzip_disable &quot;msie [1-6]\\.&quot;;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    server {</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">        listen       8080;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">        server_name  localhost;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">        #charset koi8-r;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">        #access_log  logs/host.access.log  main;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">        # http://192.168.205.207:8080/html/</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">        # 访问项目中的html文件</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">        location /html {</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">            # 项目文件存放位置</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">            root   /usr/local/nginx/;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">		   # 设置默认网页首页 </span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">            index  index.html index.htm;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">        # 404页面</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">        error_page  404              /404.html;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">        location = /404.html {</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">            root   html;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">            index 404.html;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">        # 404页面</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">        # @指向</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">        error_page  404              @404;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">        location @404 {</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">            default_type  text/plain;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">            return 404 &#39;404...&#39;;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">	    # 更改状态码</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">        error_page  404 =200             /404.html;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">        location = /404.html {</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">            root   html;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">            index 404.html;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">        # redirect server error pages to the static page /50x.html</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">        # 错误码，遇到对应的错误时，则跳转到该页面</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">        # 重定向</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">        error_page   500 502 503 504 404  /50x.html;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">        location = /50x.html {</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">            root   html;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">        }</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">	}</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="collapsed-lines"></div></div><h3 id="server-name" tabindex="-1"><a class="header-anchor" href="#server-name"><span>server_name</span></a></h3><p>通配符</p><p>这样只要有<code>nginx521.cn</code>和<code>www.nginx123</code>就可以访问nginx页面了</p><div class="language- line-numbers-mode" data-ext="" data-title=""><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>server_name *.nginx521.cn www.nginx123.*</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><code>server_name</code>访问优先级：精确（<code>www.nginx521.cn</code>）&gt; <code>default_server</code> &gt; 通配符（<code>www.nginx123.*</code>） &gt; 正则表达式</p><h3 id="location" tabindex="-1"><a class="header-anchor" href="#location"><span>location</span></a></h3><div class="language- line-numbers-mode" data-ext="" data-title=""><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span># http://192.168.205.207/html   正常</span></span>
<span class="line"><span># http://192.168.205.207/html/index.html   正常</span></span>
<span class="line"><span>location /html {</span></span>
<span class="line"><span>	root   /usr/local/nginx/;</span></span>
<span class="line"><span>	index  index.html index.htm;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span># http://192.168.205.207/html   正常</span></span>
<span class="line"><span># http://192.168.205.207/html/index.html   404</span></span>
<span class="line"><span># 要求访问路径必须和 = 后面的一致</span></span>
<span class="line"><span>location =/html {</span></span>
<span class="line"><span>	root   /usr/local/nginx/;</span></span>
<span class="line"><span>	index  index.html index.htm;</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>location</code>访问优先级：通配符 &gt; 正则表达式 &gt; 精确值（<code>/html</code>）</p><div class="language- line-numbers-mode has-collapsed collapsed" data-ext="" data-title="" style="--vp-collapsed-lines:15;"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span># 访问模式：root路径 + location路径</span></span>
<span class="line"><span># 相当于访问 /usr/local/nginx/html</span></span>
<span class="line"><span>location /html {</span></span>
<span class="line"><span>	root   /usr/local/nginx/;</span></span>
<span class="line"><span>	index  index.html index.htm;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 访问模式：alias路径 会把 location路径 替换掉</span></span>
<span class="line"><span># 这就是为什么有的页面root的可以正常访问，而alias的不可以</span></span>
<span class="line"><span># 路径的末尾要加上 /，否则会有路径问题</span></span>
<span class="line"><span># 相当于访问 /usr/local/nginx/</span></span>
<span class="line"><span>location /html {</span></span>
<span class="line"><span>	alias   /usr/local/nginx/;</span></span>
<span class="line"><span>	index  index.html index.htm;</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="collapsed-lines"></div></div>`,81)]))}const h=i(l,[["render",p],["__file","index.html.vue"]]),r=JSON.parse('{"path":"/nginx/q3h6y23f/","title":"Nginx","lang":"zh-CN","frontmatter":{"title":"Nginx","createTime":"2025/11/01 16:36:04","permalink":"/nginx/q3h6y23f/","description":"nginx有master进程和worker进程，master管理多个worker进程，worker进程则是管理用户连接 yum安装 更多详细教程：nginx: Linux packages 安装先决条件： 要设置 yum 存储库，请创建以下内容命名的文件：/etc/yum.repos.d/nginx.repo 默认情况下，使用稳定的 nginx 包的存...","head":[["meta",{"property":"og:url","content":"https://mao-design.pages.dev/nginx/q3h6y23f/"}],["meta",{"property":"og:site_name","content":"Mao-Design的博客"}],["meta",{"property":"og:title","content":"Nginx"}],["meta",{"property":"og:description","content":"nginx有master进程和worker进程，master管理多个worker进程，worker进程则是管理用户连接 yum安装 更多详细教程：nginx: Linux packages 安装先决条件： 要设置 yum 存储库，请创建以下内容命名的文件：/etc/yum.repos.d/nginx.repo 默认情况下，使用稳定的 nginx 包的存..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-09-22T16:25:14.000Z"}],["meta",{"property":"article:modified_time","content":"2025-09-22T16:25:14.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Nginx\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-09-22T16:25:14.000Z\\",\\"author\\":[]}"]]},"headers":[],"readingTime":{"minutes":12.25,"words":3675},"git":{"updatedTime":1758558314000,"contributors":[{"name":"mao-design","email":"2781406006@qq.com","commits":2,"avatar":"https://avatars.githubusercontent.com/mao-design?v=4","url":"https://github.com/mao-design"}]},"autoDesc":true,"filePathRelative":"notes/Nginx/Nginx.md","bulletin":false}');export{h as comp,r as data};
